---
import Icon from '@/components/Icon.astro';
import { CONTACT_INFO } from '@/consts/contact';
import SectionLayout from '@/layouts/SectionLayout.astro';
---

<SectionLayout id="contacto">
  <div class="grid grid-cols-1 items-center gap-16 lg:grid-cols-2">
    <div class="scroll-reveal font-mono">
      <div
        class="text-brand-highlight mb-6 flex items-center gap-4 font-mono text-xs tracking-[0.4em] uppercase"
      >
        <span class="bg-brand-primary h-px w-10"></span>Contactanos
      </div>
      <h2
        class="text-text-main mb-8 text-[clamp(2rem,5vw,3.5rem)] leading-tight font-black uppercase"
      >
        Inicia tu <br /><span class="text-brand-primary">Reparación</span>
      </h2>
      <p
        class="text-text-muted border-brand-deep mb-8 max-w-[500px] border-l-2 pl-6 font-mono text-lg leading-relaxed"
      >
        Contactanos por <a
          href={`https://wa.me/${CONTACT_INFO.find(contact => contact.name === 'phone')?.details[0]}?text=${encodeURIComponent('Hola, estoy teniendo problemas con mi dispositivo')}`}
          target="_blank"
          rel="noopener noreferrer"
          class="text-text-main hover:text-shadow-brand-glow underline underline-offset-4 hover:text-shadow-sm"
          >WhatsApp
        </a>, <a
          href="https://instagram.com/em_servicio_tecnico"
          target="_blank"
          rel="noopener noreferrer"
          class="text-text-main hover:text-shadow-brand-glow underline underline-offset-4 hover:text-shadow-sm"
          >Instagram
        </a>, o en nuestro taller
      </p>

      <!-- Contact Info Cards -->
      <div
        class="grid grid-cols-[repeat(auto-fit,minmax(min(260px,100%),max-content))] gap-8"
      >
        {
          CONTACT_INFO.map((info, index) => (
            <div
              class="scroll-reveal space-y-1"
              style={`transition-delay: ${index * 0.1}s`}
            >
              <div class="flex gap-3">
                <Icon
                  name={info.icon}
                  class="text-brand-primary size-6 shrink-0"
                />
                <h4 class="text-text-main mb-1 font-bold lg:text-lg">
                  {info.title}
                </h4>
              </div>
              <div class="text-text-muted space-y-1 text-sm lg:text-base">
                {info.details.map(detail => (
                  <p>{detail}</p>
                ))}
              </div>
            </div>
          ))
        }
      </div>
    </div>

    <div
      class="scroll-reveal border-text-main-ghost bg-surface-card relative border p-6 lg:p-12"
    >
      <div
        class="border-brand-primary absolute right-[-5px] bottom-[-5px] h-5 w-5 border-r-2 border-b-2"
      >
      </div>
      <form name="contact-form">
        <div class="mb-6">
          <label
            for="device-input"
            class="text-text-muted mb-2 block font-mono text-xs lg:text-base"
            >DISPOSITIVO</label
          >
          <input
            id="device-input"
            name="device"
            class="border-text-main-ghost bg-surface-input text-text-main focus:border-brand-primary w-full border px-4 py-4 transition-colors duration-300 outline-none"
            type="text"
            placeholder="Ej: iPhone 13 Pro Max"
            pattern="[\w\s\-\.]+"
            minlength="3"
            required
          />
        </div>
        <div class="mb-6">
          <label
            for="description-input"
            class="text-text-muted mb-2 block font-mono text-xs lg:text-base"
          >
            DESCRIPCIÓN
          </label>
          <textarea
            id="description-input"
            name="description"
            class="border-text-main-ghost bg-surface-input text-text-main focus:border-brand-primary w-full border px-4 py-4 transition-colors duration-300 outline-none"
            rows="4"
            placeholder="No enciende, pantalla rota..."
            minlength="10"
            required></textarea>
        </div>
        <button
          class="hover:bg-brand-primary border-brand-primary text-text-main hover:border-brand-highlight hover:text-text-inverse relative inline-flex w-full cursor-pointer items-center justify-center gap-3 overflow-hidden border bg-transparent px-10 py-[1.2rem] font-mono font-bold tracking-widest uppercase transition-colors duration-500 hover:-translate-y-0.5 hover:shadow-[0_0_30px_var(--color-brand-glow)]"
          type="submit"
        >
          Enviar Mensaje
        </button>

        <div class="bg-brand-ghost mt-6 p-4">
          <div class="mb-2 flex items-center gap-3">
            <Icon name="whatsapp" class="text-brand-primary size-5 shrink-0" />
            <p
              class="text-brand-primary font-mono text-xs font-bold tracking-wider uppercase lg:text-base"
            >
              Contacta por WhatsApp
            </p>
          </div>
          <p
            class="text-text-muted mt-1 font-mono text-xs opacity-80 lg:text-sm"
          >
            Al enviar, redirige WhatsApp con los datos precargados en el
            mensaje, para mayor comodidad.
          </p>
        </div>
      </form>
    </div>
  </div>
</SectionLayout>

<script>
  import { WHATSAPP_NUMBER } from '@/consts/contact';

  // Form WhatsApp Send Message
  const contactForm: HTMLFormElement | null = document.querySelector(
    'form[name="contact-form"]'
  );

  contactForm?.addEventListener('submit', e => {
    e.preventDefault();

    const formData = new FormData(contactForm);
    const device = formData.get('device');
    const description = formData.get('description');

    const message = `Hola, quisiera reparar:\n\n*Dispositivo:* ${device}\n*Problema:* ${description}`;
    const whatsappNumber = WHATSAPP_NUMBER;
    const encodedMessage = encodeURIComponent(message);
    const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;

    window.open(whatsappURL, '_blank', 'noopener,noreferrer');

    contactForm.reset();
  });
</script>
