---
import Icon from '@/components/Icon.astro';

const NAV_ITEMS = [
  {
    label: 'Servicios',
    href: '#servicios',
  },
  {
    label: 'Proceso',
    href: '#proceso',
  },
  {
    label: 'Contacto',
    href: '#contacto',
  },
];
---

<header
  class="content bg-surface-base sticky inset-x-0 top-0 z-50 py-4 backdrop-blur-[10px]"
>
  <nav class="flex items-center justify-between">
    <button
      id="logo-btn"
      aria-label="Ir al inicio"
      class="text-brand-primary flex cursor-pointer items-center gap-3 text-left"
    >
      <Icon name="logo" class="size-12" />
      <div class="grid">
        <span class="text-text-main font-mono text-xl font-bold"
          >EM Servicios</span
        >
        <span class="text-text-muted font-mono text-xs lg:text-base"
          >Reparación y mantenimiento</span
        >
      </div>
    </button>

    <!-- Desktop Menu -->
    <div class="hidden lg:flex">
      {
        NAV_ITEMS.map(item => (
          <a
            href={item.href}
            class="text-text-muted hover:text-brand-highlight px-4 py-2 font-mono text-base transition-colors duration-300 lg:text-lg"
          >
            {item.label}
          </a>
        ))
      }
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-btn"
      type="button"
      aria-controls="mobile-menu"
      aria-expanded="false"
      aria-label="Abrir menú de navegación"
      class="group text-text-main inline-flex h-12 w-12 items-center justify-center text-center lg:hidden"
    >
      <span class="sr-only">Menu</span>
      <svg
        class="pointer-events-none h-6 w-6 fill-current"
        viewBox="0 0 16 16"
        xmlns="http://www.w3.org/2000/svg"
      >
        <rect
          class="origin-center translate-x-[7px] -translate-y-[5px] transition-all duration-300 ease-[cubic-bezier(.5,.85,.25,1.1)] group-aria-expanded:translate-x-0 group-aria-expanded:translate-y-0 group-aria-expanded:rotate-[315deg]"
          y="7"
          width="9"
          height="2"
          rx="1"></rect>
        <rect
          class="origin-center transition-all duration-300 ease-[cubic-bezier(.5,.85,.25,1.8)] group-aria-expanded:rotate-45"
          y="7"
          width="16"
          height="2"
          rx="1"></rect>
        <rect
          class="origin-center translate-y-[5px] transition-all duration-300 ease-[cubic-bezier(.5,.85,.25,1.1)] group-aria-expanded:translate-y-0 group-aria-expanded:-rotate-[225deg]"
          y="7"
          width="9"
          height="2"
          rx="1"></rect>
      </svg>
    </button>

    <!-- Mobile Menu Dropdown -->
    <div
      id="mobile-menu"
      aria-hidden="true"
      class="border-brand-ghost fixed inset-x-0 top-full z-40 overflow-hidden border-b bg-[oklch(from_var(--color-surface-base)_l_c_h/0.95)] px-6 backdrop-blur-sm lg:hidden"
    >
      {
        NAV_ITEMS.map(item => (
          <a
            href={item.href}
            class="text-text-muted hover:text-brand-highlight block py-4 font-mono text-base transition-colors duration-300 lg:text-lg"
          >
            {item.label}
          </a>
        ))
      }
    </div>
  </nav>
</header>

<style>
  header {
    box-shadow: 0px 1px 1px 0px var(--color-brand-glow);
  }

  #mobile-menu {
    --animation-duration: 250ms;
    interpolate-size: allow-keywords;
    visibility: visible;
    transition:
      height var(--animation-duration) ease,
      visibility var(--animation-duration);
  }

  @media screen and (width < 64rem) {
    #mobile-menu-btn[aria-expanded='false'] ~ #mobile-menu {
      visibility: hidden;
      height: 0;
    }
  }
</style>

<script>
  const logoBtn = document.getElementById('logo-btn');
  logoBtn?.addEventListener('click', () => window.scrollTo(0, 0));

  // Mobile Menu Toggle
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  let isMenuOpen = false;

  // Function to toggle menu state
  function toggleMenu() {
    isMenuOpen = !isMenuOpen;

    if (isMenuOpen) {
      // Update ARIA attributes
      mobileMenuBtn?.setAttribute('aria-expanded', 'true');
      mobileMenuBtn?.setAttribute('aria-label', 'Cerrar menú de navegación');
      mobileMenu?.setAttribute('aria-hidden', 'false');
    } else {
      // Update ARIA attributes
      mobileMenuBtn?.setAttribute('aria-expanded', 'false');
      mobileMenuBtn?.setAttribute('aria-label', 'Abrir menú de navegación');
      mobileMenu?.setAttribute('aria-hidden', 'true');
    }
  }

  // Toggle menu on button click
  mobileMenuBtn?.addEventListener('click', toggleMenu);

  // Close menu when clicking a link
  document.querySelectorAll('#mobile-menu a').forEach(link => {
    link.addEventListener('click', () => {
      if (isMenuOpen) {
        toggleMenu();
      }
    });
  });

  // Close menu on ESC key
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && isMenuOpen) {
      toggleMenu();
      mobileMenuBtn?.focus();
    }
  });
</script>
