---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { ROUTES } from '@/consts/routes.ts';

type RouteName = (typeof ROUTES)[number]['name'];

type FilteredRoutesProps = {
  routes: typeof ROUTES;
} & (
  | {
      // Escenario 1: Se aplica un filtro
      filterType: 'include' | 'exclude';
      routesList: Array<RouteName>; // routesList es REQUERIDO
    }
  | {
      // Escenario 2: No se aplica filtro
      filterType?: null;
      routesList?: never; // routesList NO debe pasarse
    }
);

function FILTERED_ROUTES({
  routes,
  filterType,
  routesList,
}: FilteredRoutesProps) {
  // Si no hay filterType, TypeScript sabe que estamos en el escenario 2
  if (!filterType) {
    return routes;
  }

  // Si llegamos aquÃ­, TypeScript sabe que estamos en el escenario 1,
  // por lo tanto, `filterType` es 'include' o 'exclude' y `routesList` EXISTE.
  if (filterType === 'include') {
    return routes.filter(route => routesList.includes(route.name));
  }

  if (filterType === 'exclude') {
    return routes.filter(route => !routesList.includes(route.name));
  }

  return null;
}

const listOfRoutes: RouteName[] = ['trabajos', 'servicios', 'contacto'];
---

<BaseLayout>
  {
    FILTERED_ROUTES({
      routes: ROUTES,
      // filterType: 'include',
      // routesList: listOfRoutes,
    })?.map(({ component: Component, id }) => (
      <Component id={id} class="bg-white nth-of-type-[odd]:bg-gray-50" />
    ))
  }
</BaseLayout>
